<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>Products (GraphQL AJAX)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body {
	font-family: system-ui, Arial;
	padding: 20px
}

table {
	border-collapse: collapse;
	width: 100%
}

th, td {
	border: 1px solid #ddd;
	padding: 8px
}

th {
	background: #f5f5f5;
	text-align: left
}
</style>
</head>
<body>
	<h1>Danh sách Product (giá tăng dần)</h1>
	<button id="btnLoad">Tải dữ liệu</button>
	<table id="tbl">
		<thead>
			<tr>
				<th>ID</th>
				<th>Title</th>
				<th>Price</th>
				<th>Categories</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>


	<script>
const GQL_ENDPOINT = "/graphql";


async function gql(query, variables={}){
const res = await fetch(GQL_ENDPOINT,{
method:'POST',
headers:{'Content-Type':'application/json'},
body: JSON.stringify({query, variables})
});
const json = await res.json();
if(json.errors){ console.error(json.errors); alert('GraphQL error. Check console.'); }
return json.data;
}


async function loadProducts(){
const query = `query($dir: SortDirection){
products(orderByPrice:$dir){ id title price categories{ name } }
}`;
const data = await gql(query,{dir:'ASC'});
const tbody = document.querySelector('#tbl tbody');
tbody.innerHTML = '';
data.products.forEach(p=>{
const tr = document.createElement('tr');
tr.innerHTML = `<td>${p.id}</td><td>${p.title}</td><td>${p.price}</td><td>${p.categories.map(c=>c.name).join(', ')}</td>`;
tbody.appendChild(tr);
});
}


document.getElementById('btnLoad').addEventListener('click', loadProducts);
</script>
</body>
</html>